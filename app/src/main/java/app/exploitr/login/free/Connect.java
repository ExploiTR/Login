package app.exploitr.login.free;


import android.os.AsyncTask;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.ProgressBar;

import java.io.IOException;
import java.lang.ref.WeakReference;

import okhttp3.FormBody;
import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.RequestBody;

class Connect extends AsyncTask<String, Integer, Integer> {

    private WeakReference<Button> button;
    private WeakReference<ProgressBar> progressBar;
    private WeakReference<ImageView> imageView;
    private WeakReference<View> snackView;

    Connect(Button buttonM, ProgressBar progressBar, ImageView imageMView, View view) {
        this.button = new WeakReference<>(buttonM);
        this.progressBar = new WeakReference<>(progressBar);
        this.imageView = new WeakReference<>(imageMView);
        this.snackView = new WeakReference<>(view);
    }

    @Override
    protected void onPreExecute() {
        super.onPreExecute();
        progressBar.get().setVisibility(View.VISIBLE);
        button.get().setVisibility(View.INVISIBLE);
    }

    @Override
    protected Integer doInBackground(String... params) {
        String user = params[0];
        String pass = params[1];

        OkHttpClient client = new OkHttpClient.Builder().build();
        RequestBody formBody = new FormBody.Builder()
                .add("username", user)
                .add("password", pass)
                .build();

        Request.Builder builder = new Request.Builder()
                .url("http://2.2.2.2/login")
                .post(formBody);
        Request request = builder.build();

        try {
            client.newCall(request).execute();
        } catch (IOException e) {
            e.printStackTrace();
        }

        return null;
    }

    @Override
    protected void onPostExecute(Integer integer) {
        super.onPostExecute(integer);

        new StatusChecker(button.get(), progressBar.get(), imageView.get(), snackView.get()).execute();

    }

}

