package app.exploitr.login.platinum.workers;

import com.spectrum.android.ping.EchoPacketBuilder;
import com.spectrum.android.ping.Ping;

import java.net.Inet6Address;
import java.net.InetAddress;

public class PingMon {

	private static boolean PING_CHECK = false;

	public static void requestPing(PingListener listener) {
		new Thread(() -> {
			InetAddress dest;
			try {
				dest = InetAddress.getByName("www.google.com");
			} catch (Exception e) {
				listener.onOutput(-1);
				e.printStackTrace();
				return;
			}

			final byte type = dest instanceof Inet6Address ? EchoPacketBuilder.TYPE_ICMP_V6 : EchoPacketBuilder.TYPE_ICMP_V4;
			EchoPacketBuilder builder = new EchoPacketBuilder(type, "a".getBytes());
			Ping ping = new Ping(dest, new Ping.PingListener() {
				@Override
				public void onPing(long timeMs, int index) {
					System.out.println(timeMs);
				//	listener.onOutput((int) timeMs);
				}

				@Override
				public void onPingException(Exception e, int count) {
					listener.onOutput(-1);
				}
			});
			ping.run();
			ping.setCount(1000);
			ping.setEchoPacketBuilder(builder);
			ping.setTimeoutMs(200);
		}).start();
	}

	public static void cancel() {
		PING_CHECK = false;
	}

	public interface PingListener {
		void onOutput(int ping);
	}
}
