package app.exploitr.fast.login;


import android.os.AsyncTask;
import android.support.design.widget.Snackbar;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;

import java.io.IOException;

import okhttp3.OkHttpClient;
import okhttp3.Request;
import okhttp3.Response;
import pl.droidsonroids.gif.GifImageView;

class Disconnect extends AsyncTask<Void, Integer, Integer> {

    private Button button;
    private GifImageView gifImageView;
    private ImageView imageView;
    private View snackView;

    Disconnect(Button buttonM, GifImageView progressBar, ImageView imageMView,View view) {
        this.button = buttonM;
        this.gifImageView = progressBar;
        this.imageView = imageMView;
        this.snackView = view;
    }

    @Override
    protected void onPreExecute() {
        super.onPreExecute();
        button.setVisibility(View.INVISIBLE);
        gifImageView.setVisibility(View.VISIBLE);
    }

    @Override
    protected Integer doInBackground(Void... params) {

        OkHttpClient connector = new OkHttpClient.Builder().build();

        Request request = new Request.Builder()
                .url("http://1.1.1.1/logout")
                .build();

        Response response = null;
        try {
            response = connector.newCall(request).execute();
        } catch (IOException e) {
            e.printStackTrace();
        }
        if (response != null) {
            response.close();
        }
        if (response != null && response.isSuccessful()) return 1;
        else return 0;
    }

    @Override
    protected void onPostExecute(Integer integer) {
        super.onPostExecute(integer);

        button.setVisibility(View.VISIBLE);
        gifImageView.setVisibility(View.INVISIBLE);
        System.out.println("Logout finished");
        if (integer == 0) {
            imageView.setImageResource(R.drawable.isconnected);
            button.setText("Logout");
            Snackbar.make(snackView,"Logout Unsuccessful",Snackbar.LENGTH_SHORT).show();
        } else {
            imageView.setImageResource(R.drawable.isconnectedx);
            button.setText("Login");
            Snackbar.make(snackView,"Successfully Logged Out",Snackbar.LENGTH_SHORT).show();
        }

    }

}

